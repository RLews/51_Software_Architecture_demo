C51 COMPILER V9.00   DRV_TIMER                                                             05/13/2019 21:07:01 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DRV_TIMER
OBJECT MODULE PLACED IN ..\output\drv_timer.obj
COMPILER INVOKED BY: D:\Keil\C51\C51\BIN\C51.EXE ..\source\driver\drv_timer.c BROWSE INCDIR(..\source\app;..\source\comp
                    -lex_driver;..\source\driver;..\source\hal) DEBUG OBJECTEXTEND PRINT(.\drv_timer.lst) OBJECT(..\output\drv_timer.obj)

line level    source

   1          
   2          
   3          #include "drv_timer.h"
   4          
   5          
   6          
   7          
   8          
   9          
  10          void DrvSysTimerInit(void)
  11          {
  12   1              TMOD &= 0xF0; //清零 T0 的控制位
  13   1              TMOD |= 0x01; //配置 T0 为模式 1
  14   1              DrvReloadSysTimerCnt();
  15   1      #ifdef D_USE_ONEMS_INTRRUPET_MODE
                      DrvEnableSysTimerInt();
              #endif
  18   1              TR0 = 1; //启动 T0      
  19   1      }
  20          
  21          void DrvEnableSysTimerInt(void)
  22          {
  23   1              ET0 = 1; //使能 T0 中断
  24   1              TR0 = 1; //启动 T0      
  25   1      }
  26          
  27          void DrvDisableSysTimerInt(void)
  28          {
  29   1              ET0 = 0; 
  30   1              TR0 = 0;
  31   1      }
  32          
  33          void DrvReloadSysTimerCnt(void)
  34          {
  35   1      #ifdef D_USE_ONEMS_INTRRUPET_MODE
                      TH0 = 0xFC; //加载 T0 重载值
                      TL0 = 0x18;
              #else
  39   1              TH0 = 0; //加载 T0 重载值
  40   1              TL0 = 0;
  41   1      #endif
  42   1      }
  43          
  44          uint8_t DrvGetSysTimerIntFlag(void)
  45          {
  46   1              return TF0;
  47   1      }
  48          
  49          uint16_t DrvGetSysTimerCnt(void)
  50          {
  51   1              uint16_t cnt = 0;
  52   1      
  53   1              DrvDisableSysTimerInt();
  54   1              
C51 COMPILER V9.00   DRV_TIMER                                                             05/13/2019 21:07:01 PAGE 2   

  55   1              cnt = TH0;
  56   1              cnt = (cnt << 8) + TL0;
  57   1      
  58   1              DrvEnableSysTimerInt();
  59   1      
  60   1              return cnt;
  61   1      }
  62          
  63          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     58    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
